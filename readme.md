# ScheduleApi

REST API сервис для управления расписанием колледжа. Проект предназначен для автоматизации работы диспетчера, синхронизации данных между старой legacy-системой и современной базой данных, а также предоставления актуального расписания клиентам.

## Архитектура и Стек

Проект построен на принципах **Clean Architecture** в сочетании с **Vertical Slice Architecture**. Это позволяет изолировать бизнес-логику каждой функции и упростить поддержку кода.

* **Framework:** ASP.NET Core
* **Data Access:**
    * **Entity Framework Core:** Основная БД (PostgreSQL). Используется для управления данными расписания и расчасовки.
    * **Dapper:** Read-only доступ к legacy БД (MS SQL Server) для эффективного импорта данных.
* **Patterns & Libraries:** * **MediatR:** Реализация CQRS (команды и запросы внутри каждого слайса).
    * **Ardalis.Result:** Единый формат ответов API и обработка ошибок.
    * **FluentValidation:** Валидация входных моделей.
* **Auth:** JWT Bearer Authentication (роль диспетчера).

---

## Базы данных и Синхронизация



Система оперирует двумя базами данных:
1.  **Legacy (MS SQL Server):** Существующая база данных с общей информацией (Преподаватели, Специальности, Группы).
2.  **Core DB (PostgreSQL):** Новая база данных сервиса. Здесь хранятся таблицы, помеченные на схеме розовым цветом: расписание, кабинеты, снятия и расчасовка.

**Особенности синхронизации:**
API выполняет перенос данных из MS SQL в Core DB. Важной частью является миграция таблицы `Subject_Teacher` в новую БД для обеспечения ссылочной целостности и возможности редактирования связей без изменения legacy-системы.

---

## Эндпоинты API

| Категория | Метод | Путь | Описание |
| :- | :- | :- | :- |
| **Auth** | POST | `/api/auth/login` | Аутентификация диспетчера и выдача токена |
| **Sync** | POST | `/api/sync/trigger` | Запуск синхронизации данных из MS SQL в Core DB |
| **Client** | GET | `/api/schedule/group/{id}` | Получение расписания для группы |
| **Client** | GET | `/api/schedule/day/{date}` | Получение расписания на конкретную дату |
| **Client** | GET | `/api/schedule/teacher/{id}` | Расписание для преподавателя |
| **Client** | GET | `/api/schedule/week` | Расписание на неделю по параметру `date` |
| **Admin** | GET | `/api/dictionary/all` | Список групп, специальностей, предметов и кабинетов (один JSON) |
| **Admin** | GET | `/api/workload` | Получение данных таблиц `Schedule` и `Removal` (расчасовка) |
| **Admin** | POST | `/api/workload/save` | Сохранение/обновление данных расчасовки и снятия |
| **Admin** | POST | `/api/schedule/finalize` | Сохранение финального варианта расписания на день |
| **Search** | GET | `/api/search` | Поиск по фильтру (преподаватель, группа, предмет и т.д.) |

---

## Схема базы данных

Согласно техническому заданию, сущности разделены по зонам ответственности:
* **Core API Entities (Розовые на схеме):** `Classrooms`, `Schedule`, `Removal`, `Subject_Teacher_Schedule`, `Limitation_on_choice_of_Audience_Subject`.
* **Legacy Entities (Белые на схеме):** `Group`, `Teacher`, `Subject`, `Specialty`, `Subject_Teacher`.

---

## Дизайн и UI
Макеты интерфейса диспетчера доступны в Figma: [Настолка_Распес](https://www.figma.com/design/9gudUAUSsOtCZIeUJs1QfC/%D0%9D%D0%B0%D1%81%D1%82%D0%BE%D0%BB%D0%BA%D0%B0_%D0%A0%D0%B0%D1%81%D0%BF%D0%B5%D1%81)